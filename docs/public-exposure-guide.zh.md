# Glitter 在公网部署的安全指南

## 公网暴露的风险概览

- **端口扫描与暴力请求**：服务一旦暴露在公网，将被自动化扫描命中。攻击者可频繁发起连接，导致带宽和 CPU 被占用，甚至触发拒绝服务。
- **身份冒充与社工风险**：当前版本主要依赖设备指纹和人工确认，没有完善的身份验证体系。公网环境下，攻击者可反复发送请求诱导用户误操作。
- **中间人与窃听**：虽然默认开启传输加密，但若误操作关闭加密或使用不安全的中间层，文件内容可能被截获。
- **信任关系难维护**：公网 IP 动态变化频繁，指纹提示难以判断，易被伪造或被利用制造恐慌。
- **恶意内容传输**：在自动接受模式下，恶意方可以发送特定文件（如巨型或带脚本的档案），消耗磁盘或诱导执行。

## 建议的防护措施

1. **身份认证与密钥管理**
   - 引入共享密钥或一次性配对码，对每次会话进行签名/验证。
   - 强制所有客户端提供高强度随机 token，并支持轮换与撤销。
   - 未来可考虑 OAuth2 / JWT 等标准认证机制。

2. **传输层与加密**
   - 配置 TLS/DTLS，使用自签或 ACME 证书，为传输层提供加密和完整性保障。
   - 禁止关闭加密选项，在公网部署时强制使用安全参数。

3. **访问控制**
   - 设置 IP 白名单或网段限制，默认拒绝未知来源。
   - 对高风险区域精准封禁，可结合地理位置或 ASN 数据。

4. **请求速率与配额**
   - 对同一来源的连接数、请求频率做限制，防止暴力尝试。
   - 维护黑名单，对异常行为（如大量失败的认证）自动封锁。

5. **内容安全**
   - 限制自动接受模式的文件大小、类型，避免恶意文件迅速落地。
   - 将自动接收默认关闭，并提供详细提示。

6. **监控与审计**
   - 全量记录传入请求日志，包含来源 IP、操作时间、文件信息。
   - 配合外部监控平台，对异常流量及时报警。

## 推荐的公网部署方式

- **VPN / 虚拟专用网络**
  - 在受控的 VPN 内运行 Glitter，确保所有访问者先通过 VPN 认证。
  - 支持的方案包括 WireGuard、OpenVPN、Tailscale、ZeroTier 等。

- **反向代理 / API 网关**
  - 将 Glitter 置于反向代理之后，由网关处理 TLS、认证和限流。
  - 可选 Nginx、Traefik、Caddy 或云端 API Gateway，并结合 WAF（Web 应用防火墙）。

- **SSH 或 TLS 隧道**
  - 使用 `ssh -L`、`ssh -R` 或 `stunnel` 等工具，将端口映射到可信主机。
  - 通过跳板机集中管理访问权限。

- **容器与隔离环境**
  - 在 Docker/Kubernetes 中部署，利用网络策略（NetworkPolicy）限制东西向流量。
  - 配合 Sidecar 做认证、加密和日志收集。

## 未来考虑新增的功能

- **自带身份认证服务**：包括用户账号、权限分级、API 密钥管理等。
- **多因素验证**：对敏感操作（如首次连线、清空历史）要求二次确认或 OTP。
- **更完善的限流与封禁机制**：可配置的速率限制、自动封禁策略。
- **内容扫描集成**：接入杀毒或沙箱服务，对收到的文件进行扫描。
- **集中化日志与告警接口**：支持输出到 ELK、Prometheus、Grafana 等平台。
- **自动化证书管理**：提供 Let's Encrypt 等 ACME 集成，简化 TLS 配置。

## 总结

Glitter 设计初衷是简洁的局域网传输工具。如果需要部署在公网，请务必叠加 VPN、认证、反向代理等多重防线，并配置速率限制与监控。当前版本尚未内建完备的公网安全机制，建议谨慎评估使用场景，并关注未来版本的安全增强计划。
